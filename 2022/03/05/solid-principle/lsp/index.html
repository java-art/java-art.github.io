

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Mehrdad Karami">
  <meta name="keywords" content="java">
  
    <meta name="description" content="Liskov Substitution Principle ExplainedThis article gives a quick intro to the Liskov Substitution Principle (LSP), why it’s important, and how to use it to validate object-oriented designs. We’ll als">
<meta property="og:type" content="article">
<meta property="og:title" content="OnlineJavaClass">
<meta property="og:url" content="http://example.com/2022/03/05/solid-principle/lsp/index.html">
<meta property="og:site_name" content="OnlineJavaClass">
<meta property="og:description" content="Liskov Substitution Principle ExplainedThis article gives a quick intro to the Liskov Substitution Principle (LSP), why it’s important, and how to use it to validate object-oriented designs. We’ll als">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/data/solid-principle/ldp-bank-class-diagram.png">
<meta property="article:published_time" content="2022-03-05T18:41:34.222Z">
<meta property="article:modified_time" content="2022-03-05T20:37:25.938Z">
<meta property="article:author" content="Mehrdad Karami">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/data/solid-principle/ldp-bank-class-diagram.png">
  
  
  <title>OnlineJavaClass</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-03-05 19:41" pubdate>
        March 5, 2022 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      13k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      112 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none"></h1>
            
            <div class="markdown-body">
              <h3 id="Liskov-Substitution-Principle-Explained"><a href="#Liskov-Substitution-Principle-Explained" class="headerlink" title="Liskov Substitution Principle Explained"></a>Liskov Substitution Principle Explained</h3><p>This article gives a quick intro to the Liskov Substitution Principle (LSP), why it’s important, and how to use it to validate object-oriented designs. We’ll also see some examples and learn how to correctly identify and fix violations of the LSP.</p>
<h3 id="What-is-the-LSP"><a href="#What-is-the-LSP" class="headerlink" title="What is the LSP?"></a>What is the LSP?</h3><p>At a high level, the LSP states that in an object-oriented program, if we substitute a superclass object reference with an object of any of its subclasses, the program should not break.</p>
<p>Say we had a method that used a superclass object reference to do something:</p>
<figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span> &#123;<br>  <br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">aMethod</span><span class="hljs-params">(SuperClass superClassReference)</span> &#123;<br>    doSomething(superClassReference);<br>  &#125;<br>  <br>  <span class="hljs-comment">// definition of doSomething() omitted</span><br>&#125;<br>```java<br><br>This should work as expected <span class="hljs-keyword">for</span> every possible subclass object of SuperClass that is passed to it. If substituting a superclass object with a subclass object changes the program behavior in unexpected ways, the LSP is violated.<br><br>The LSP is applicable when there’s a supertype-subtype inheritance relationship by either extending a <span class="hljs-keyword">class</span> <span class="hljs-title class_">or</span> implementing an interface. <br><br></code></pre></td></tr></table></figure>
<p>We can think of the methods defined in the supertype as defining a contract. Every subtype is expected to stick to this contract. If a subclass does not adhere to the superclass’s contract, it’s violating the LSP.</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><br><span class="hljs-comment">This makes sense intuitively </span><span class="hljs-literal">-</span> <span class="hljs-comment">a</span> <span class="hljs-comment">class’s contract tells its clients what to expect. If a subclass extends or overrides the behavior of the superclass in unintended</span> <span class="hljs-comment">ways</span><span class="hljs-string">,</span> <span class="hljs-comment">it would break the clients</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">How can a method in a subclass break a</span> <span class="hljs-comment">superclass</span> <span class="hljs-comment">method’s</span> <span class="hljs-comment">contract? There are several possible</span> <span class="hljs-comment">ways:</span><br><br><span class="hljs-comment">1</span><span class="hljs-string">.</span> <span class="hljs-comment">Returning</span> <span class="hljs-comment">an</span> <span class="hljs-comment">object</span> <span class="hljs-comment">that’s incompatible with the object</span> <span class="hljs-comment">returned</span> <span class="hljs-comment">by</span> <span class="hljs-comment">the</span> <span class="hljs-comment">superclass</span> <span class="hljs-comment">method</span><span class="hljs-string">.</span><br><span class="hljs-comment">2</span><span class="hljs-string">.</span> <span class="hljs-comment">Throwing a new exception that’s</span> <span class="hljs-comment">not</span> <span class="hljs-comment">thrown</span> <span class="hljs-comment">by</span> <span class="hljs-comment">the</span> <span class="hljs-comment">superclass</span> <span class="hljs-comment">method</span><span class="hljs-string">.</span><br><span class="hljs-comment">3</span><span class="hljs-string">.</span> <span class="hljs-comment">Changing</span> <span class="hljs-comment">the</span> <span class="hljs-comment">semantics</span> <span class="hljs-comment">or introducing side effects that are not part of</span> <span class="hljs-comment">the</span> <span class="hljs-comment">superclass’s</span> <span class="hljs-comment">contract</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">Java and other statically-typed languages</span> <span class="hljs-comment">prevent</span> <span class="hljs-comment">1</span> <span class="hljs-comment">(unless</span> <span class="hljs-comment">we use very generic classes</span> <span class="hljs-comment">like</span> <span class="hljs-comment">Object)</span> <span class="hljs-comment">and</span> <span class="hljs-comment">2</span> <span class="hljs-comment">(for</span> <span class="hljs-comment">checked</span> <span class="hljs-comment">exceptions)</span> <span class="hljs-comment">by flagging them at compile</span><span class="hljs-literal">-</span><span class="hljs-comment">time</span><span class="hljs-string">.</span> <span class="hljs-comment">It’s still possible to violate</span> <span class="hljs-comment">the</span> <span class="hljs-comment">LSP in these languages via</span> <span class="hljs-comment">the</span> <span class="hljs-comment">third</span> <span class="hljs-comment">way</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">#### Why is the LSP</span> <span class="hljs-comment">Important?</span><br><br><span class="hljs-comment">LSP violations are a design</span> <span class="hljs-comment">smell</span><span class="hljs-string">.</span> <span class="hljs-comment">We may have generalized a concept prematurely and created a superclass where none</span> <span class="hljs-comment">is</span> <span class="hljs-comment">needed</span><span class="hljs-string">.</span><br><span class="hljs-comment">Future requirements for the concept might not fit the</span> <span class="hljs-comment">class</span> <span class="hljs-comment">hierarchy</span> <span class="hljs-comment">we</span> <span class="hljs-comment">have</span> <span class="hljs-comment">created</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">If client code cannot substitute a superclass reference with a subclass object freely</span><span class="hljs-string">,</span> <span class="hljs-comment">it</span> <span class="hljs-comment">would</span> <span class="hljs-comment">be</span> <span class="hljs-comment">forced</span> <span class="hljs-comment">to</span> <span class="hljs-comment">do instanceof checks and specially</span> <span class="hljs-comment">handle</span> <span class="hljs-comment">some</span> <span class="hljs-comment">subclasses</span><span class="hljs-string">.</span><br><span class="hljs-comment">If</span> <span class="hljs-comment">this</span> <span class="hljs-comment">kind</span> <span class="hljs-comment">of conditional code is spread</span> <span class="hljs-comment">across</span> <span class="hljs-comment">the</span> <span class="hljs-comment">codebase</span><span class="hljs-string">,</span> <span class="hljs-comment">it</span> <span class="hljs-comment">will</span> <span class="hljs-comment">be</span> <span class="hljs-comment">difficult</span> <span class="hljs-comment">to</span> <span class="hljs-comment">maintain</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">Every</span> <span class="hljs-comment">time</span> <span class="hljs-comment">we</span> <span class="hljs-comment">add</span> <span class="hljs-comment">or</span> <span class="hljs-comment">modify</span> <span class="hljs-comment">a</span> <span class="hljs-comment">subclass</span><span class="hljs-string">,</span> <span class="hljs-comment">we would have to comb through the codebase and change multiple places. This is difficult and error</span><span class="hljs-literal">-</span><span class="hljs-comment">prone</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">It also defeats the purpose</span> <span class="hljs-comment">of introducing the supertype abstraction in the first place which is to make it easy to enhance</span> <span class="hljs-comment">the</span> <span class="hljs-comment">program</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">It may not even be possible to identify all the places and change</span> <span class="hljs-comment">them</span> <span class="hljs-literal">-</span> <span class="hljs-comment">we may not own or control the client code</span><span class="hljs-string">.</span> <span class="hljs-comment">We</span> <span class="hljs-comment">could</span> <span class="hljs-comment">be developing our functionality as a library and providing them to external users</span><span class="hljs-string">,</span> <span class="hljs-comment">for</span> <span class="hljs-comment">example</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">####</span> <span class="hljs-comment">Violating</span> <span class="hljs-comment">the</span> <span class="hljs-comment">LSP</span> <span class="hljs-literal">-</span> <span class="hljs-comment">An</span> <span class="hljs-comment">Example</span><br><br><span class="hljs-comment">Suppose</span> <span class="hljs-comment">we were building the payment module for our eCommerce website. Customers order products on the site and pay using payment instruments like a credit card</span> <span class="hljs-comment">or</span> <span class="hljs-comment">a</span> <span class="hljs-comment">debit</span> <span class="hljs-comment">card</span><span class="hljs-string">.</span><br><br>&gt; <span class="hljs-comment">When a customer provides their</span> <span class="hljs-comment">card</span> <span class="hljs-comment">details</span><span class="hljs-string">,</span> <span class="hljs-comment">we</span> <span class="hljs-comment">want</span> <span class="hljs-comment">to</span><br>&gt; <span class="hljs-literal">-</span> <span class="hljs-comment">validate</span> <span class="hljs-comment">it</span><span class="hljs-string">,</span><br>&gt; <span class="hljs-literal">-</span> <span class="hljs-comment">run it through a third</span><span class="hljs-literal">-</span><span class="hljs-comment">party</span> <span class="hljs-comment">fraud</span> <span class="hljs-comment">detection</span> <span class="hljs-comment">system</span><span class="hljs-string">,</span><br>&gt; <span class="hljs-literal">-</span> <span class="hljs-comment">and then send the details to a payment gateway</span> <span class="hljs-comment">for</span> <span class="hljs-comment">processing</span><span class="hljs-string">.</span><br><br><br><span class="hljs-comment">While some basic validations are required on all cards</span><span class="hljs-string">,</span> <span class="hljs-comment">there are additional validations needed on credit cards. Once the payment is done</span><span class="hljs-string">,</span> <span class="hljs-comment">we record it in our</span> <span class="hljs-comment">database</span><span class="hljs-string">.</span> <span class="hljs-comment">Because</span> <span class="hljs-comment">of various security and regulatory</span> <span class="hljs-comment">reasons</span><span class="hljs-string">,</span> <span class="hljs-comment">we</span> <span class="hljs-comment">don’t store the actual card details in our database</span><span class="hljs-string">,</span> <span class="hljs-comment">but a fingerprint identifier for</span> <span class="hljs-comment">it</span> <span class="hljs-comment">that’s</span> <span class="hljs-comment">returned</span> <span class="hljs-comment">by</span> <span class="hljs-comment">the</span> <span class="hljs-comment">payment</span> <span class="hljs-comment">gateway</span><span class="hljs-string">.</span><br><br><span class="hljs-comment">Given</span> <span class="hljs-comment">these</span> <span class="hljs-comment">requirements</span><span class="hljs-string">,</span> <span class="hljs-comment">we might model our classes</span> <span class="hljs-comment">as</span> <span class="hljs-comment">below:</span><br><br></code></pre></td></tr></table></figure>
<p>abstract class PaymentInstrument {<br>  String name;<br>  String cardNumber;<br>  String verificationCode;<br>  Date expiryDate;<br>  String fingerprint;</p>
<p>  void validate() throws PaymentInstrumentInvalidException {<br>    &#x2F;&#x2F; basic validation on name, expiryDate etc.<br>    if (name &#x3D;&#x3D; null || name.isEmpty()) {<br>      throw new PaymentInstrumentInvalidException(“Name is invalid”);<br>    }<br>    &#x2F;&#x2F; other validations<br>  }</p>
<p>  void runFraudChecks() throws FraudDetectedException {<br>    &#x2F;&#x2F; run checks against a third-party system<br>  }</p>
<p>  void sendToPaymentGateway() throws PaymentFailedException {<br>    &#x2F;&#x2F; send details to payment gateway (PG) and set fingerprint from<br>    &#x2F;&#x2F; the payment gateway response<br>  }<br>}<br>~</p>
<p>~<br>class CreditCard extends PaymentInstrument {</p>
<p>  @Override<br>  void validate() throws PaymentInstrumentInvalidException {<br>    super.validate();<br>    &#x2F;&#x2F; additional validations for credit cards<br>  }<br>  &#x2F;&#x2F; other credit card-specific code<br>}<br>~</p>
<p>~<br>class DebitCard extends PaymentInstrument {<br>  &#x2F;&#x2F; debit card-specific code<br>}<br>~</p>
<p>A different area in our codebase where we process a payment might look something like this:</p>
<p>~<br>class PaymentProcessor {<br>  void process(OrderDetails orderDetails, PaymentInstrument paymentInstrument) {<br>    try {<br>      paymentInstrument.validate();<br>      paymentInstrument.runFraudChecks();<br>      paymentInstrument.sendToPaymentGateway();<br>      saveToDatabase(orderDetails, paymentInstrument);<br>    } catch (…){<br>        &#x2F;&#x2F; exception handling<br>    }<br>  }</p>
<p>  void saveToDatabase(<br>      OrderDetails orderDetails,<br>      PaymentInstrument paymentInstrument) {<br>    String fingerprint &#x3D; paymentInstrument.getFingerprint();<br>    &#x2F;&#x2F; save fingerprint and order details in DB<br>  }<br>}<br>~</p>
<p>Of course, in an actual production system, there would be many complex aspects to handle. The single processor class above might well be a bunch of classes in multiple packages across service and repository layers.</p>
<p>All is well and our system is processing payments as expected. At some point, the marketing team decides to introduce reward points to increase customer loyalty. Customers get a small number of reward points for each purchase. They can use the points to buy products on the site.</p>
<p>Ideally, we should be able to just add a <em><strong>RewardsCard</strong></em> class that extends <em><strong>PaymentInstrument</strong></em> and be done with it. But we find that adding it violates the LSP!</p>
<p>There are no fraud checks for Rewards Cards. Details are not sent to payment gateways and there is no concept of a fingerprint identifier.<br><em><strong>PaymentProcessor</strong></em> breaks as soon as we add <em><strong>RewardsCard</strong></em>.</p>
<p>We might try force-fitting <em><strong>RewardsCard</strong></em> into the current class hierarchy by overriding <em><strong>runFraudChecks()</strong></em> and <em><strong>sendToPaymentGateway()</strong></em> with empty, do-nothing implementations.</p>
<p>This would still break the application - we might get a <em><strong>NullPointerException</strong></em> from the <em><strong>saveToDatabase()</strong></em> method since the fingerprint would be null. Can we handle it just this once as a special case in <em><strong>saveToDatabase()</strong></em> by doing an ***instanceofv check on the <em><strong>PaymentInstrument</strong></em> argument?</p>
<p>But we know that if we do it once, we’ll do it again. Soon our codebase will be strewn with multiple checks and special cases to handle the problems created by the incorrect class model. We can imagine the pain this will cause each time we enhance the payment module.</p>
<p>For example, what if the business decides to accept Bitcoins? Or marketing introduces a new payment mode like Cash on Delivery?</p>
<h4 id="Fixing-the-Design"><a href="#Fixing-the-Design" class="headerlink" title="Fixing the Design"></a>Fixing the Design</h4><p>Let’s revisit the design and create supertype abstractions only if they are general enough to create code that is flexible to requirement changes. We will also use the following object-oriented design principles:</p>
<blockquote>
<ul>
<li>Program to interface, not implementation</li>
<li>Encapsulate what varies</li>
<li>Prefer composition over inheritance</li>
</ul>
</blockquote>
<p>To start with, what we can be sure of is that our application needs to collect payment - both at present and in the future. It’s also reasonable to think that we would want to validate whatever payment details we collect. Almost everything else could change. So let’s define the below interfaces:</p>
<p>~<br>interface PaymentInstrument{<br>  void validate() throws PaymentInstrumentInvalidException;<br>  PaymentResponse collectPayment() throws PaymentFailedException;<br>}<br>~</p>
<p>~<br>class PaymentResponse {<br>  String identifier;<br>}<br>~</p>
<p><strong>PaymentResponse</strong> encapsulates an <strong>identifier</strong> - this could be the fingerprint for credit and debit cards or the card number for rewards cards.<br>It could be something else for a different payment instrument in the future. The encapsulation ensures <strong>PaymentInstrument</strong> can remain unchanged if future payment instruments have more data.</p>
<p><strong>PaymentProcessor</strong> class now looks like this:</p>
<p>~<br>class PaymentProcessor {<br>  void process(<br>      OrderDetails orderDetails,<br>      PaymentInstrument paymentInstrument) {<br>    try {<br>      paymentInstrument.validate();<br>      PaymentResponse response &#x3D; paymentInstrument.collectPayment();<br>      saveToDatabase(orderDetails, response.getIdentifier());<br>    } catch (…) {<br>      &#x2F;&#x2F; exception handling<br>    }<br>  }</p>
<p>  void saveToDatabase(OrderDetails orderDetails, String identifier) {<br>    &#x2F;&#x2F; save the identifier and order details in DB<br>  }<br>}<br>~</p>
<p>There are no <strong>runFraudChecks()</strong> and <strong>sendToPaymentGateway()</strong> calls in <strong>PaymentProcessor</strong> anymore - these are not general enough to apply to all payment instruments.</p>
<p>Let’s add a few more interfaces for other concepts which seem general enough in our problem domain:</p>
<p>~<br>interface FraudChecker {<br>  void runChecks() throws FraudDetectedException;<br>}<br>~</p>
<p>~<br>interface PaymentGatewayHandler {<br>  PaymentGatewayResponse handlePayment() throws PaymentFailedException;<br>}<br>~</p>
<p>~<br>interface PaymentInstrumentValidator {<br>  void validate() throws PaymentInstrumentInvalidException;<br>}<br>~</p>
<p>~<br>class PaymentGatewayResponse {<br>  String fingerprint;<br>}<br>~</p>
<p>And here are the implementations:</p>
<p>~<br>class ThirdPartyFraudChecker implements FraudChecker {<br>  &#x2F;&#x2F; members omitted</p>
<p>  @Override<br>  void runChecks() throws FraudDetectedException {<br>    &#x2F;&#x2F; external system call omitted<br>  }<br>}<br>~</p>
<p>~<br>class PaymentGatewayHandler implements PaymentGatewayHandler {<br>  &#x2F;&#x2F; members omitted</p>
<p>  @Override<br>  PaymentGatewayResponse handlePayment() throws PaymentFailedException {<br>    &#x2F;&#x2F; send details to payment gateway (PG), set the fingerprint<br>    &#x2F;&#x2F; received from PG on a PaymentGatewayResponse and return<br>  }<br>}<br>~</p>
<p>~<br>class BankCardBasicValidator implements PaymentInstrumentValidator {<br>  &#x2F;&#x2F; members like name, cardNumber etc. omitted</p>
<p>  @Override<br>  void validate() throws PaymentInstrumentInvalidException {<br>    &#x2F;&#x2F; basic validation on name, expiryDate etc.<br>    if (name &#x3D;&#x3D; null || name.isEmpty()) {<br>      throw new PaymentInstrumentInvalidException(“Name is invalid”);<br>    }<br>    &#x2F;&#x2F; other basic validations<br>  }<br>}<br>~</p>
<p>Let’s build <strong>CreditCard</strong> and <strong>DebitCard</strong> abstractions by composing the above building blocks in different ways.<br>We first define a class that implements <strong>PaymentInstrument</strong>:</p>
<p>~<br>abstract class BaseBankCard implements PaymentInstrument {<br>  &#x2F;&#x2F; members like name, cardNumber etc. omitted<br>  &#x2F;&#x2F; below dependencies will be injected at runtime<br>  PaymentInstrumentValidator basicValidator;<br>  FraudChecker fraudChecker;<br>  PaymentGatewayHandler gatewayHandler;</p>
<p>  @Override<br>  void validate() throws PaymentInstrumentInvalidException {<br>    basicValidator.validate();<br>  }</p>
<p>  @Override<br>  PaymentResponse collectPayment() throws PaymentFailedException {<br>    PaymentResponse response &#x3D; new PaymentResponse();<br>    try {<br>      fraudChecker.runChecks();<br>      PaymentGatewayResponse pgResponse &#x3D; gatewayHandler.handlePayment();<br>      response.setIdentifier(pgResponse.getFingerprint());<br>    } catch (FraudDetectedException e) {<br>      &#x2F;&#x2F; exception handling<br>    }<br>    return response;<br>  }<br>}</p>
<p>~</p>
<p>~<br>class CreditCard extends BaseBankCard {<br>  &#x2F;&#x2F; constructor omitted</p>
<p>  @Override<br>  void validate() throws PaymentInstrumentInvalidException {<br>    basicValidator.validate();<br>    &#x2F;&#x2F; additional validations for credit cards<br>  }<br>}<br>~</p>
<p>~<br>class DebitCard extends BaseBankCard {<br>  &#x2F;&#x2F; constructor omitted<br>}<br>~</p>
<p>Though <strong>CreditCard</strong> and <strong>DebitCard</strong> extend a class, it’s not the same as before.<br>Other areas of our codebase now depend only on the <strong>PaymentInstrument</strong> interface, not on <strong>BaseBankCard</strong>.<br>Below snippet shows <strong>CreditCard</strong> object creation and processing:</p>
<p>~<br>PaymentGatewayHandler gatewayHandler &#x3D;<br>  new PaymentGatewayHandler(name, cardNum, code, expiryDate);</p>
<p>PaymentInstrumentValidator validator &#x3D;<br>  new BankCardBasicValidator(name, cardNum, code, expiryDate);</p>
<p>FraudChecker fraudChecker &#x3D;<br>  new ThirdPartyFraudChecker(name, cardNum, code, expiryDate);</p>
<p>CreditCard card &#x3D;<br>  new CreditCard(<br>    name,<br>    cardNum,<br>    code,<br>    expiryDate,<br>    validator,<br>    fraudChecker,<br>    gatewayHandler);</p>
<p>paymentProcessor.process(order, card);<br>~</p>
<p>Our design is now <strong>flexible enough</strong> to let us add a <strong>RewardsCard</strong> - no force-fitting and no conditional checks.<br>We just add the new class and it works as expected.</p>
<p>~<br>class RewardsCard implements PaymentInstrument {<br>  String name;<br>  String cardNumber;</p>
<p>  @Override<br>  void validate() throws PaymentInstrumentInvalidException {<br>    &#x2F;&#x2F; Rewards card related validations<br>  }</p>
<p>  @Override<br>  PaymentResponse collectPayment() throws PaymentFailedException {<br>    PaymentResponse response &#x3D; new PaymentResponse();<br>    &#x2F;&#x2F; Steps related to rewards card payment like getting current<br>    &#x2F;&#x2F; rewards balance, updating balance etc.<br>    response.setIdentifier(cardNumber);<br>    return response;<br>  }<br>}<br>~</p>
<p>And here’s client code using the new card:</p>
<p>~<br>RewardsCard card &#x3D; new RewardsCard(name, cardNum);<br>paymentProcessor.process(order, card);<br>~</p>
<h4 id="Here-is-the-final-class-diagram"><a href="#Here-is-the-final-class-diagram" class="headerlink" title="Here is the final class diagram"></a>Here is the final class diagram</h4><p><img src="/data/solid-principle/ldp-bank-class-diagram.png" srcset="/img/loading.gif" lazyload alt="final-class-diagram"></p>
<h4 id="Advantages-of-the-New-Design"><a href="#Advantages-of-the-New-Design" class="headerlink" title="Advantages of the New Design"></a>Advantages of the New Design</h4><p>The new design not only fixes the LSP violation but also gives us a loosely-coupled, flexible set of classes to handle changing requirements.<br>For example, adding new payment instruments like Bitcoin and Cash on Delivery is easy - we just add new classes that implement <strong>PaymentInstrument</strong>.</p>
<p>Business needs debit cards to be processed by a different payment gateway? No problem - we add a new class that implements <strong>PaymentGatewayHandler</strong> and inject it into <strong>DebitCard</strong>.<br>If DebitCard’s requirements begin to diverge a lot from CreditCard’s, we can have it implement directly instead of extending <strong>BaseBankCard</strong> - <em>no other class is impacted</em>.</p>
<p>If we need an in-house fraud check for <strong>RewardsCard</strong>, we add an <strong>InhouseFraudChecker</strong> that implements <strong>FraudChecker</strong>, inject it into <strong>RewardsCard</strong> and only change <strong>RewardsCard.collectPayment()</strong>.</p>
<h4 id="How-to-Identify-LSP-Violations"><a href="#How-to-Identify-LSP-Violations" class="headerlink" title="How to Identify LSP Violations?"></a>How to Identify LSP Violations?</h4><p>Some good indicators to identify LSP violations are:</p>
<p>Conditional logic (using the <strong>instanceof</strong> operator or <strong>object.getClass().getName()</strong> to identify the actual <strong>subclass</strong>)<br>in client code empty, do-nothing implementations of one or more methods in subclasses throwing an <strong>UnsupportedOperationException</strong> or some other unexpected exception from a subclass method.</p>
<p>Consider <strong>java.util.List<E></strong> interface’s <strong>add(E e)</strong> method. Since <strong>java.util.Arrays.asList(T …)</strong> returns an unmodifiable list, client code which adds an element to a List would break if it were passed a List returned by <strong>Arrays.asList</strong>.</p>
<p>Is this an LSP violation? No - the <strong>List.add(E e)</strong> method’s contract says implementations may throw an <strong>UnsupportedOperationException</strong>. Clients are expected to handle this when using the method.</p>
<h4 id="Example-output"><a href="#Example-output" class="headerlink" title="Example output"></a>Example output</h4><div class="code-wrapper"><pre><code class="hljs">Starting payment processing for customer Mehrdad with creadit card number 1234-1234-1234-1234-1234
Running fraud checks against third-party system
Fraud checks passed
Sending details to payment gateway
Credit card payment successful!
Starting payment processing for customer Mehrdad with rewards card number 1234-1234-1234-1234-1234
Updating rewards balance
Rewards card payment successful!
</code></pre></div>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/03/05/solid/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Guide to S.O.L.I.D Principles</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/03/05/structures/dfs/">
                        <span class="hidden-mobile">Depth First Search - DFS</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
